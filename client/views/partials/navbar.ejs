<nav class="navbar">
    <a href="/" class="logo">
        <i class="fas fa-train"></i> Chilahati
    </a>
    <div class="nav-links">
        <a href="/" class="nav-item">Home</a>

        <!-- DROPDOWN MENU -->
        <div class="dropdown">
            <button id="categories-btn" class="nav-item dropdown-toggle" type="button">
                Categories <i class="fas fa-chevron-down" style="font-size: 0.8em; margin-left: 5px;"></i>
            </button>
            <div id="categories-menu" class="dropdown-menu">
                <a href="/archive/history" class="dropdown-item"><i class="fas fa-history"></i> History</a>
                <a href="/archive/culture" class="dropdown-item"><i class="fas fa-palette"></i> Culture</a>
                <a href="/archive/institution" class="dropdown-item"><i class="fas fa-university"></i> Institutions</a>
                <a href="/archive/notable-people" class="dropdown-item"><i class="fas fa-user-tie"></i> Notable
                    People</a>
                <a href="/archive/freedom-fighter" class="dropdown-item"><i class="fas fa-fist-raised"></i> Freedom
                    Fighters</a>
                <a href="/archive/meritorious-student" class="dropdown-item"><i class="fas fa-user-graduate"></i>
                    Meritorious Students</a>
                <a href="/archive/occupation" class="dropdown-item"><i class="fas fa-tools"></i> Occupation</a>
                <a href="/archive/hidden-talent" class="dropdown-item"><i class="fas fa-star"></i> Hidden Talent</a>
                <a href="/archive/heart-breaking-story" class="dropdown-item"><i class="fas fa-heart-broken"></i>
                    Breaking Stories</a>
                <a href="/archive/tourist-spots" class="dropdown-item"><i class="fas fa-camera-retro"></i> Tourist
                    Spots</a>
                <a href="/archive/transport" class="dropdown-item"><i class="fas fa-train"></i> Transport</a>
                <a href="/archive/emergency-service" class="dropdown-item"><i class="fas fa-hand-holding-medical"></i>
                    Emergency</a>
                <a href="/archive/social-work" class="dropdown-item"><i class="fas fa-hands-helping"></i> Social
                    Work</a>
                <a href="/archive/sopnotory-foundation" class="dropdown-item"><i class="fas fa-lightbulb"></i> Sopnotory
                    Foundation</a>
                <a href="/map" class="dropdown-item"><i class="fas fa-map-marked-alt"></i> Interactive Map</a>
            </div>
        </div>

        <a href="#" class="nav-item">Contribute</a>
        <a href="#" class="nav-item">Contact</a>
        <a href="#" class="nav-item">About Us</a>
    </div>

    <div class="nav-actions">
        <button id="theme-toggle" class="theme-toggle-btn" title="Toggle Dark Mode">
            <i class="fas fa-moon"></i>
        </button>
        <div class="search-box">
            <form action="/search" method="GET" style="display:flex;">
                <input type="text" name="q" class="search-txt" placeholder="Search...">
                <button type="submit" class="search-btn-icon"><i class="fas fa-search"></i></button>
            </form>
        </div>

        <!-- AUTH BUTTONS LOGIC -->
        <% if (!user) { %>
            <a href="/login" class="login-btn">Login</a>
            <a href="/register" class="register-btn">Register</a>
            <% } else { %>
                <!-- Admin/Supervisor Menu -->
                <% if (user.role==='admin' || user.role==='supervisor' ) { %>
                    <a href="/admin/add" class="nav-item" style="color: #ffda79;"><i class="fas fa-plus-circle"></i> Add
                        Content</a>
                    <% } %>

                        <a href="/profile" class="nav-item">Hi, <%= user.username %></a>
                        <a href="/logout" class="login-btn" style="padding: 0.5rem 1rem; font-size: 0.9rem;">Logout</a>
                        <% } %>
    </div>
</nav>

<!-- THEME TOGGLE SCRIPT -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const themeToggleBtn = document.getElementById('theme-toggle');
        const body = document.body;
        const icon = themeToggleBtn.querySelector('i');

        const currentTheme = localStorage.getItem('theme');
        if (currentTheme === 'dark') {
            body.classList.add('dark-mode');
            icon.classList.remove('fa-moon');
            icon.classList.add('fa-sun');
        }

        themeToggleBtn.addEventListener('click', () => {
            body.classList.toggle('dark-mode');

            if (body.classList.contains('dark-mode')) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
                localStorage.setItem('theme', 'dark');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
                localStorage.setItem('theme', 'light');
            }
        });
    });
</script>

<!-- DROPDOWN TOGGLE SCRIPT -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const categoriesBtn = document.getElementById('categories-btn');
        const categoriesMenu = document.getElementById('categories-menu');
        const dropdown = categoriesBtn.closest('.dropdown');

        // Toggle dropdown on button click
        categoriesBtn.addEventListener('click', function (e) {
            e.preventDefault();
            e.stopPropagation();
            dropdown.classList.toggle('active');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function (e) {
            if (!dropdown.contains(e.target)) {
                dropdown.classList.remove('active');
            }
        });

        // Prevent dropdown from closing when clicking inside the menu
        categoriesMenu.addEventListener('click', function (e) {
            // Allow navigation to links, but stop propagation to prevent closing
            if (e.target.classList.contains('dropdown-item') || e.target.closest('.dropdown-item')) {
                // Let the link navigate normally
                return;
            }
            e.stopPropagation();
        });
    });
</script>